-- ğŸ§­ V19__admin_features.sql
-- ê´€ë¦¬ì ì‹œìŠ¤í…œ: ëŒ€ì‹œë³´ë“œ í†µê³„ ë° ì œíœ´ ìƒí’ˆ ê´€ë¦¬ìš© í…Œì´ë¸”

-- 1. ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì¼ë³„ í†µê³„ í…Œì´ë¸”
CREATE TABLE admin_daily_stats (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    stats_date DATE NOT NULL UNIQUE,          -- ì§‘ê³„ ë‚ ì§œ
    total_users INTEGER NOT NULL DEFAULT 0,    -- ì´ ì´ìš©ì ìˆ˜
    total_dentists INTEGER NOT NULL DEFAULT 0, -- ì´ ì œíœ´ ì¹˜ê³¼ ìˆ˜
    new_inquiries INTEGER NOT NULL DEFAULT 0,  -- ì‹ ê·œ ë¬¸ì˜ ê±´ìˆ˜
    weekly_usage INTEGER NOT NULL DEFAULT 0,   -- ìµœê·¼ 7ì¼(ì›”~ì¼) ëˆ„ì  ì´ìš© ê±´ìˆ˜
    user_trend DECIMAL(5, 2) DEFAULT 0.00,     -- ì „ì¼ ëŒ€ë¹„ ì´ìš©ì ì¦ê°€ìœ¨ (%)
    created_at TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW()
);

-- 2. ì œíœ´ ì¹˜ê³¼ ì „ìš© ìƒí’ˆ ê´€ë¦¬ í…Œì´ë¸”
CREATE TABLE partner_products (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    category VARCHAR(100) NOT NULL,            -- ì¹«ì†”ë¥˜, ì¹˜ì•½ ë° ì„¸ì •ì œ, ì¹˜ê°„, í˜€ ë° êµ¬ê°•, íŠ¹ìˆ˜ì¼€ì–´, ê¸°íƒ€
    name VARCHAR(255) NOT NULL,               -- ì œí’ˆëª…
    price INTEGER NOT NULL,                   -- ê°€ê²©
    manufacturer VARCHAR(255),                -- ì œì¡°íšŒì‚¬
    image_url TEXT,                           -- ìƒí’ˆ ì´ë¯¸ì§€ URL
    created_at TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW()
);

-- 3. ì œíœ´ ë³´í—˜ ì „ìš© ìƒí’ˆ ê´€ë¦¬ í…Œì´ë¸”
CREATE TABLE insurance_products (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    category VARCHAR(100) NOT NULL,            -- ë³´í—˜ ì¢…ë¥˜
    name VARCHAR(255) NOT NULL,               -- ë³´í—˜ëª…
    price INTEGER NOT NULL,                   -- ë³´í—˜ë£Œ
    company VARCHAR(255),                     -- ë³´í—˜íšŒì‚¬
    created_at TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW()
);

-- ì¸ë±ìŠ¤ ì¶”ê°€ (ì¡°íšŒ ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX idx_admin_stats_date ON admin_daily_stats(stats_date);
CREATE INDEX idx_partner_product_cat ON partner_products(category);
CREATE INDEX idx_insurance_product_cat ON insurance_products(category);

-- 4. ê´€ë¦¬ì ë¬¸ì˜ ë‚´ì—­ í…Œì´ë¸”
CREATE TABLE admin_inquiries (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nickname VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    title VARCHAR(255) NOT NULL,
    content TEXT,
    status VARCHAR(50) NOT NULL DEFAULT 'PENDING',
    created_at TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_admin_inquiry_created ON admin_inquiries(created_at);
